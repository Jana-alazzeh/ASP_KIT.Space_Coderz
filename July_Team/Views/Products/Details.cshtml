@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> Localizar
@model July_Team.Models.ProductDetailViewModel

@{
    ViewData["Title"] = Model.Name;
}

<div class="container py-5 fade-in">
    <div class="product-wrapper shadow-lg">
        <div class="row g-0">
            <div class="col-lg-6 bg-light-blue d-flex flex-column align-items-center justify-content-center p-4">
                <div class="main-image-wrapper">
                    <img src="@Model.ImageUrl" id="mainImage" class="img-fluid main-product-img" alt="@Model.Name">
                </div>

                <div class="thumbnail-row d-flex justify-content-center gap-3 mt-4">
                    <img src="@Model.ImageUrl" class="thumb active" onclick="changeImage(this.src, this)" alt="Front">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl_Back))
                    {
                        <img src="@Model.ImageUrl_Back" class="thumb" onclick="changeImage(this.src, this)" alt="Back">
                    }
                </div>
            </div>

            <div class="col-lg-5 p-4 p-md-5 bg-white">
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a asp-controller="Products" asp-action="Index">@Localizar["Store"]</a></li>
                        <li class="breadcrumb-item active">@Model.Name</li>
                    </ol>
                </nav>

                <h1 class="product-title">@Model.Name</h1>
                <div class="price-badge mb-4">@Model.Price.ToString("N0") <span>JD</span></div>

                <p class="product-desc text-muted mb-4">@Model.Description</p>

                <hr class="my-4 opacity-25">

                <form asp-controller="Cart" asp-action="AddToCart" method="post" id="addToCartForm">
                    <input type="hidden" asp-for="ProductId" />

                    @* لا تظهر المقاسات إلا إذا كان هناك "AvailableStock" أو منطق للمقاسات *@
                    @if (Model.AvailableStock > 0) @* هنا يمكنك إضافة شرط (&& Model.HasSizes) إذا كان متاحاً في الـ Model *@
                    {
                        <div class="mb-4">
                            <label class="form-label fw-bold text-dark">@Localizar["SelectSize"]</label>
                            <div class="size-selector d-flex flex-wrap gap-2">
                                @foreach (var size in new[] { "S", "M", "L", "XL", "XXL" })
                                {
                                    <input type="radio" class="btn-check" name="SelectedSize" id="size-@size" value="@size" required>
                                    <label class="btn btn-outline-primary size-btn" for="size-@size">@size</label>
                                }
                            </div>
                            @* رسالة تنبيه مخصصة *@
                            <div class="invalid-feedback" id="sizeError">@Localizar["PleaseSelectSize"]</div>
                        </div>
                    }

                    <div class="row g-3 align-items-end mb-5">
                        <div class="col-4">
                            <label class="form-label fw-bold">@Localizar["Quantity"]</label>
                            <div class="quantity-input-group">
                                <button type="button" onclick="this.parentNode.querySelector('input').stepDown()" class="qty-btn">-</button>
                                <input type="number" asp-for="SelectedQuantity" class="form-control text-center" min="1" max="@Model.AvailableStock" value="1">
                                <button type="button" onclick="this.parentNode.querySelector('input').stepUp()" class="qty-btn">+</button>
                            </div>
                        </div>
                        <div class="col-8">
                            <button type="submit" class="btn btn-add-to-cart w-100">
                                <span class="btn-text">@Localizar["AddToCart"]</span>
                                <i class="bi bi-bag-plus-fill ms-2"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // تبديل الصور بسلاسة
        function changeImage(src, element) {
            document.getElementById('mainImage').src = src;
            document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
        }

        // تنبيه المستخدم إذا نسي المقاس
        document.getElementById('addToCartForm').onsubmit = function(e) {
            const sizeSelected = document.querySelector('input[name="SelectedSize"]:checked');
            const errorDiv = document.getElementById('sizeError');

            if (!sizeSelected) {
                e.preventDefault();
                errorDiv.style.display = 'block';
                document.querySelector('.size-selector').style.borderColor = '#e3342f';
            }
        };
    </script>
}